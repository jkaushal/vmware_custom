<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="ecc_agent_script_include">
    <ecc_agent_script_include action="INSERT_OR_UPDATE">
        <active>true</active>
        <description>Script for CAPI - VMWare Custom Compute API.ResetVMWareToolsUpgrade</description>
        <name>compute-custom-1.0-ResetVMWareToolsUpgra</name>
        <script><![CDATA[updateConfigTools(this.parameters);

function updateConfigTools(parameters){
	ms.log("VMARE Reset Tools START");
    var VMUtils = new Packages.com.snc.cmp.connector.util.VMUtils();

    var serviceInstance = getServiceInstance(parameters,VMUtils);
    var location = parameters.get('Location');
    var instanceName = parameters.get('NodeName');
	
	ms.log("VMARE Reset Tools Instance Name: " + instanceName);

    var inventoryNavigator = new Packages.com.vmware.vim25.mo.InventoryNavigator(serviceInstance.getRootFolder());

    var configSpec = new Packages.com.vmware.vim25.VirtualMachineConfigSpec();
	
    var toolConfig = new Packages.com.vmware.vim25.ToolsConfigInfo();
	
    toolConfig.setToolsUpgradePolicy("manual");
    configSpec.setTools(toolConfig);

    var vm = inventoryNavigator.searchManagedEntity("VirtualMachine", instanceName);
	var vmClass = vm.getClass();
	var methods = vmClass.getMethods();

	var vmTask;
    try {
        vmTask = vm.reconfigVM_Task(configSpec);
    }
    catch(err){
        throw new GenericException('Could not update VM tools config: ' + err);
    }

    var taskStatus = vmTask.waitForTask() + '';

    var success = 'success';


    if (taskStatus != null && taskStatus.toUpperCase() != success.toUpperCase()){
        throw new GenericException('Task error updating VM tools config: '  + taskStatus);
    }

    return;
}

function getServiceInstance(parameters,VMUtils){
    var connectionParams = new Packages.java.util.HashMap();
    connectionParams.put('vmware.server.url',parameters.get('Endpoint'));
    connectionParams.put('vmware.username',parameters.get('Identity'));
    connectionParams.put('vmware.password',parameters.get('Credentials'));

    return VMUtils.getServiceInstance(connectionParams);
}]]></script>
        <sys_class_name>ecc_agent_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-07-15 09:31:27</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>29568edf77a23300c14554389a1061f2</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>compute-custom-1.0-ResetVMWareToolsUpgra</sys_name>
        <sys_overrides/>
        <sys_package display_value="VMWare Custom" source="sn_vmware_custom">0e87a59377a23300c14554389a10613c</sys_package>
        <sys_policy/>
        <sys_scope display_value="VMWare Custom">0e87a59377a23300c14554389a10613c</sys_scope>
        <sys_update_name>ecc_agent_script_include_29568edf77a23300c14554389a1061f2</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-07-15 09:31:43</sys_updated_on>
    </ecc_agent_script_include>
</record_update>
